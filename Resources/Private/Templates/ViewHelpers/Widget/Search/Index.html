<script src="{f:uri.resource(path: 'Contrib/visualsearch/build/dependencies.js', package: 'KayStrobach.VisualSearch')}" type="text/javascript"></script>
<script src="{f:uri.resource(path: 'Contrib/visualsearch/build/visualsearch.js', package: 'KayStrobach.VisualSearch')}" type="text/javascript"></script>
<!--[if (!IE)|(gte IE 8)]><!-->
<link href="{f:uri.resource(path: 'Contrib/visualsearch/build/visualsearch-datauri.css', package: 'KayStrobach.VisualSearch')}" media="screen" rel="stylesheet" type="text/css" />
<!--<![endif]-->
<!--[if lte IE 7]><!-->
<link href="{f:uri.resource(path: 'Contrib/visualsearch/build/visualsearch.css', package: 'KayStrobach.VisualSearch')}" media="screen" rel="stylesheet" type="text/css" />
<!--<![endif]-->

<!--
{f:uri.resource(path: 'Contrib/visualsearch/images/embed/icons/cancel_search.png', package: 'KayStrobach.VisualSearch')}
{f:uri.resource(path: 'Contrib/visualsearch/images/embed/icons/search_glyph.png', package: 'KayStrobach.VisualSearch')}
-->

<f:if condition="{search}">
	<f:then>
		<div class="visual_search"
		     data-valueAction="{f:widget.uri(action:'values', ajax: true)}"
		     data-facets="{facets -> f:format.json() -> f:format.htmlspecialchars()}"

		     ></div>

		<script type="text/javascript" charset="utf-8">
			$(document).ready(function() {
				window.visualSearch = VS.init({
					container : $('.visual_search'),
					query     : '',
					callbacks : {
						search       : function(query, searchCollection) {},
						facetMatches : function(callback) {
							callback(
								$.parseJSON($('.visual_search').first().attr('data-facets'))
							);
						},
						valueMatches : function(facet, searchTerm, callback) {
							var restServerURL = "http://localhost:7474/db/data";
							$.ajax({
								type: "POST",
								//contentType: "application/json; charset=utf-8",
								url: $('.visual_search').first().attr('data-valueAction'),
								dataType: "json",
								data: {facet: facet, query: searchTerm},
								success: function(data) {
									callback(data);
								}
							});
						}
					}
				});
			});
		</script>
	</f:then>
	<f:else>
		<p>Parameter search is wrong ...</p>
	</f:else>
</f:if>

